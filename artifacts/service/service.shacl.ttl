@prefix service: <https://w3id.org/gaia-x4plcaad/ontologies/service/v2/> .
@prefix envited-x: <https://w3id.org/ascs-ev/envited-x/envited-x/v3/> .
@prefix manifest: <https://w3id.org/ascs-ev/envited-x/manifest/v5/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# The Shapes Graph URI appends "/shapes" to the Ontology URI
<https://w3id.org/gaia-x4plcaad/ontologies/service/v2/shapes>
    a owl:Ontology ;
    # The Shapes Graph must import the Domain Ontology
    owl:imports <https://w3id.org/gaia-x4plcaad/ontologies/service/v2> .

service:ServiceShape a sh:NodeShape ;
    sh:closed false ;
    sh:targetClass service:Service ;

    # 1) hasServiceOffering
    sh:property [
        sh:path service:hasServiceOffering ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:or (
            [ sh:node envited-x:ServiceOfferingBaseShape ]
            [ sh:and ( manifest:LinkShape envited-x:ExtendedLinkShape ) ]
        ) ;
        sh:message "Each Service must have exactly one associated ServiceOfferingBase (either inline or a valid manifest:Link)."@en ;
    ] ;

    # 2) hasDomainSpecification
    sh:property [
        sh:path service:hasDomainSpecification ;
        sh:node service:DomainSpecificationShape ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Each Service must have one associated DomainSpecification with content."@en ;
    ] ;

    # 3) hasManifest
    sh:property [
        sh:path service:hasManifest ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:or (
            [ sh:and ( manifest:ManifestShape envited-x:ManifestShape ) ]
            [ sh:node envited-x:ManifestLinkReferenceShape ]
        ) ;
        sh:message "Each Service must have exactly one manifest."@en ;
    ] .

# DomainSpecification shape
service:DomainSpecificationShape a sh:NodeShape ;
    sh:closed false ;

    sh:property [
        sh:path service:hasContent ;
        sh:node service:ContentShape ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Each DomainSpecification must have one Content facet."@en ;
    ] .

# Content shape â€” service-specific metadata
service:ContentShape a sh:NodeShape ;
    sh:closed false ;

    sh:property [
        sh:node service:RequiredFileShape ;
        sh:order 1 ;
        sh:name "required file object"@en ;
        sh:description "Required file object with properties for urls and description."@en ;
        sh:path service:requiredFile ;
    ] ;
    sh:property [
        sh:minCount 1 ;
        sh:node service:ResultingFileShape ;
        sh:order 2 ;
        sh:name "resulting file object"@en ;
        sh:description "Resulting file object with properties for url and description."@en ;
        sh:path service:resultingFile ;
    ] .

service:RequiredFileShape a sh:NodeShape ;
    sh:property [ skos:example "A scenario following the ASAM OpenSCENARIO 2.0.0 standard as an .osc file."@en ;
            sh:datatype xsd:string ;
            sh:description "Human readable description of the required file."@en ;
            sh:minCount 1 ;
            sh:maxCount 1 ;
            sh:message "Validation of description failed!"@en ;
            sh:name "description"@en ;
            sh:order 1 ;
            sh:path service:description ] ,
        [ skos:example "https://www.asam.net/standards/detail/openscenario/v200/" ;
            sh:datatype xsd:anyURI ;
            sh:description "Uniform Resource Identifier (URI) to identify to a formal specification of the file."@en ;
            sh:maxCount 1 ;
            sh:message "Validation of specification failed!"@en ;
            sh:name "specification"@en ;
            sh:order 2 ;
            sh:path service:specification ] ,
        [ skos:example "https://sd-creation-wizard.gxfs.gx4fm.org/" ;
            sh:datatype xsd:anyURI ;
            sh:description "Uniform Resource Identifier (URI) to identify to a tool to help create the file."@en ;
            sh:maxCount 1 ;
            sh:message "Validation of tooling failed!"@en ;
            sh:name "tooling"@en ;
            sh:order 3 ;
            sh:path service:tooling ];

    sh:targetClass service:RequiredFile .

service:ResultingFileShape a sh:NodeShape ;
    sh:property [ skos:example "The ground-truth data of the executed simulation following the ASAM OSI v3.7.0 standard as a .osi file."@en ;
            sh:datatype xsd:string ;
            sh:description "Human readable description."@en ;
            sh:minCount 1 ;
            sh:maxCount 1 ;
            sh:message "Validation of description failed!"@en ;
            sh:name "description"@en ;
            sh:order 1 ;
            sh:path service:description ],
        [ skos:example "https://www.asam.net/standards/detail/osi/" ;
            sh:datatype xsd:anyURI ;
            sh:description "Uniform Resource Identifier (URI) to identify to a formal specification of the file."@en ;
            sh:minCount 1 ;
            sh:maxCount 1 ;
            sh:message "Validation of specification failed!"@en ;
            sh:name "specification"@en ;
            sh:order 2 ;
            sh:path service:specification ] ;
    sh:targetClass service:ResultingFile .
