@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix survey: <https://w3id.org/gaia-x4plcaad/ontologies/survey/v6/> .
@prefix envited-x: <https://w3id.org/ascs-ev/envited-x/envited-x/v3/> .
@prefix manifest: <https://w3id.org/ascs-ev/envited-x/manifest/v5/> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .

# The Shapes Graph URI appends "/shapes" to the Ontology URI
<https://w3id.org/gaia-x4plcaad/ontologies/survey/v6/shapes>
    a owl:Ontology ;
    # The Shapes Graph must import the Domain Ontology
    owl:imports <https://w3id.org/gaia-x4plcaad/ontologies/survey/v6> .

survey:SurveyResultDataOfferingShape a sh:NodeShape ;
    sh:closed false ;
    sh:targetClass survey:SurveyResultDataOffering ;

    # 1) hasResourceDescription
    sh:property [
        sh:path survey:hasResourceDescription ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:or (
            [ sh:node envited-x:ResourceDescriptionShape ]
            [ sh:and ( manifest:LinkShape envited-x:ExtendedLinkShape ) ]
        ) ;
        sh:message "Each SurveyResultDataOffering must have exactly one associated ResourceDescription (either inline or a valid manifest:Link)."@en ;
    ] ;

    # 2) hasDomainSpecification
    sh:property [
        sh:path survey:hasDomainSpecification ;
        sh:node survey:ResultDomainSpecificationShape ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Each SurveyResultDataOffering must have one associated DomainSpecification with content."@en ;
    ] ;

    # 3) hasManifest
    sh:property [
        sh:path survey:hasManifest ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:or (
            [ sh:and ( manifest:ManifestShape envited-x:ManifestShape ) ]
            [ sh:node envited-x:ManifestLinkReferenceShape ]
        ) ;
        sh:message "Each SurveyResultDataOffering must have exactly one manifest."@en ;
    ] .

# DomainSpecification shape for result data
survey:ResultDomainSpecificationShape a sh:NodeShape ;
    sh:closed false ;

    sh:property [
        sh:path survey:hasContent ;
        sh:node survey:ResultContentShape ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Each ResultDomainSpecification must have one Content facet."@en ;
    ] .

# Content shape for result data
survey:ResultContentShape a sh:NodeShape ;
    sh:closed false ;

    sh:property [
        sh:path survey:surveyStartTime ;
        sh:datatype xsd:dateTime ;
        skos:example "'Date 1'" ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Validation of survey start time failed." ;
        sh:name "Survey start time" ;
        sh:description "When the survey was started." ;
    ] ;
    sh:property [
        sh:path survey:surveyCloseTime ;
        sh:datatype xsd:dateTime ;
        skos:example "'Date 1'" ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Validation of survey close time failed." ;
        sh:name "Survey close time" ;
        sh:description "When the survey was closed." ;
    ] ;
    sh:property [
        sh:path survey:belongsTo ;
        sh:nodeKind sh:IRI ;
        sh:class survey:SurveyServiceOffering ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:message "Validation of assigned survey service offering failed." ;
        sh:name "Survey service offering" ;
        sh:description "Accompanied survey service offering." ;
    ] ;
    sh:property [
        sh:path survey:dataSize ;
        sh:datatype xsd:float ;
        sh:minCount 0 ;
        sh:maxCount 1 ;
        sh:message "Validation of data size failed." ;
        sh:name "Data size" ;
    ] .
