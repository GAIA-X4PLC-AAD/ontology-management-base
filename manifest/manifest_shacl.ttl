@prefix manifest: <https://github.com/GAIA-X4PLC-AAD/ontology-management-base/tree/main/manifest/> .
@prefix gx: <https://registry.lab.gaia-x.eu/development/api/trusted-shape-registry/v1/shapes/jsonld/trustframework#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .

manifest:ManifestShape a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property
        [   sh:description "Self-reference to the manifest.json providing the structure and list of contents for a domain specific asset."@en ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:node manifest:LinkShape ;
            sh:order 0 ;
            sh:path manifest:manifest ],
        [   sh:description "Defines the license(s) valid for all content referenced in the manifest. Does not apply to linked data(sets) with explicit license terms."@en ;
            sh:minCount 1 ;
            sh:node manifest:LicenseShape ;
            sh:order 1 ;
            sh:path manifest:license ],
        [   sh:description "Defines the links to all relevant data (sets) for a domain specific asset. This is extended and structures in the asset specific ontology."@en ;
            sh:minCount 1 ;
            sh:node manifest:LinkShape ;
            sh:order 2 ;
            sh:path manifest:content ];
    sh:targetClass manifest:Manifest .

manifest:LicenseShape a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property 
        [   sh:description "Defines a standard SPDX identifier or custom license references."@en ;
            skos:example "Any spdx identifier e.g MIT from <https://spdx.org/licenses/>, LicenseRef-Custom-Commercial-Agreement for a provider specific .LICENSE file, LicenseRef-Policy-Smart-Contract for a provider specific policy smart contract refernce."@en ;
            sh:datatype xsd:string ;
            sh:message "Validation of spdx identifier failed!"@en ;
            sh:minCount 1 ;
            sh:maxCount 1 ;
            sh:name "spdx identifier"@en ;
            sh:order 1 ;
            sh:or (
                [ sh:in ("LicenseRef-Custom-Commercial-Agreement" "LicenseRef-Policy-Smart-Contract") ]
                [ sh:pattern "^([A-Za-z0-9-.+]+)$" ]  # Pattern for standard SPDX identifiers
    )
            sh:path gx:license
        ],      
        [   sh:description "Defines a link to the license."@en ;
            skos:example "accessRole: publicUser, type: license, format: html, path: <https://opensource.org/license/mit>"@en ;
            sh:message "Validation of licenseData failed!"@en ;
            sh:minCount 1 ;
            sh:maxCount 1 ;
            sh:name "license data"@en ;
            sh:node manifest:LinkShape ;
            sh:order 2 ;
            sh:path manifest:licenseData 
        ];
    sh:targetClass manifest:License .

manifest:LinkShape a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property 
       [    sh:description "Specifies the access role associated with the corresponding file."@en ;
            skos:example "publicUser";
            sh:in ("owner" "registeredUser" "publicUser") ;
            sh:datatype xsd:string ;
            sh:message "Validation of accessRole failed!"@en ;
            sh:name "access role"@en ;
            sh:order 0 ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path manifest:accessRole 
        ],
        [   sh:description "Specifies the category of the corresponding data file. The categories may represet the structure of the asset e.g. in an archive."@en ;
            skos:example "metadata";
            sh:in ("manifest" "coreData" "documentation" "media" "metadata" "validationReports" "license" "miscellaneous") ;
            sh:datatype xsd:string ;
            sh:message "Validation of category failed!"@en ;
            sh:name "category"@en ;
            sh:order 1 ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path manifest:category 
        ],
        [
            sh:description "Defines the properties of the data file that is referenced via a link."@en ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:node manifest:FileMetaDataShape ;
            sh:order 2 ;
            sh:path manifest:fileMetaData
        ]; 
    sh:targetClass manifest:Link .
    
manifest:FileMetaDataShape a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property 
        [   sh:description "Uniform Resource Identifier (URI) to identify the resource by location, name, or both."@en ;
            skos:example "./metadata/gxMetadata.json";
            sh:datatype xsd:anyURI ;
            sh:message "Validation of path failed!"@en ;
            sh:name "path"@en ;
            sh:order 0 ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path manifest:uri 
        ],
        [ 
            sh:description "Defines the IPFS CIDv1 identifier of the file."@en ;
            skos:example "bafkreic6xmosvgr4a5735itquknu2ljf4fon7wohrzlmabepwkkxtih6um";
            sh:datatype xsd:string;
            sh:message "The CIDv1 identifier is not valid or is a CIDv0 identifier."@en ;
            sh:name "IPFS CIDv1";
            sh:order 1;
            sh:maxCount 1;
            sh:minCount 0;
            sh:path manifest:hash;
            sh:pattern "^((?!Qm[1-9A-HJ-NP-Za-km-z]{44,})|b[A-Za-z2-7]{58,}|B[A-Z2-7]{58,}|z[1-9A-HJ-NP-Za-km-z]{48,}|F[0-9A-F]{50,})$" 
        ],     
        [
            sh:description "Defines the MIME type of the file."@en ;
            skos:example "application/pdf";
            sh:datatype xsd:string;
            sh:message "Validation of the MIME type failed!"@en ;
            sh:name "MIME type";
            sh:order 2;
            sh:maxCount 1;
            sh:minCount 0;
            sh:path manifest:mimeType;
            sh:pattern "^(application|audio|font|example|image|message|model|multipart|text|video)/[a-zA-Z0-9!#$&^_.+-]+$|^x-[a-zA-Z0-9!#$&^_.+-]+/[a-zA-Z0-9!#$&^_.+-]+$";
        ],
        [
            sh:description "Defines the dimensions for images and videos."@en ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:node manifest:DimensionsShape ;
            sh:order 3 ;
            sh:path manifest:dimensions
        ], 
        [
            sh:description "Specifies the file size in bytes."@en ;
            skos:example "1048576" ;
            sh:datatype xsd:integer ;
            sh:message "Validation of file size failed!"@en ;
            sh:name "file size"@en ;
            sh:order 4 ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path manifest:fileSize ;
        ],
        [
            sh:description "Specifies the file name (excluding the path) along with its extension."@en ;
            skos:example "example.txt" ;
            sh:datatype xsd:string ;
            sh:message "Filename validation failed!"@en ;
            sh:name "filename"@en ;
            sh:order 5 ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path manifest:filename ;
            sh:pattern "^([\\w,\\s-]+(?:\\.[\\w,\\s-]+)*)\\.([A-Za-z0-9]+)$" ;
        ],
        [
            sh:description "Represents a date or time associated with the file, such as recording time or creation time."@en ;
            skos:example "2022-04-01T00:00:00" ;
            sh:datatype xsd:dateTime ;
            sh:message "Validation of timestamp failed!"@en ;
            sh:name "timestamp"@en ;
            sh:order 6 ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path manifest:timestamp ;
        ];
    sh:targetClass manifest:FileMetaData .

manifest:DimensionsShape a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property 
        [
            sh:description "Specifies the unit of measurement (e.g., metres, inches)."@en ;
            skos:example "metres" ;
            sh:datatype xsd:string ;
            sh:message "Unit must be a valid measurement unit."@en ;
            sh:name "Unit" ;
            sh:order 0 ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path manifest:unit ;
            sh:in ("metres" "inches" "pixels") ;
        ],
        [
            sh:description "Specifies the width (x-axis) of the item in appropriate units."@en ;
            skos:example "1920" ;
            sh:datatype xsd:decimal ;
            sh:message "Width must be a positive number."@en ;
            sh:name "Width" ;
            sh:order 1 ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path manifest:width ;
        ],
        [
            sh:description "Specifies the height (y-axis) of the item in appropriate units."@en ;
            skos:example "1080" ;
            sh:datatype xsd:decimal ;
            sh:message "Height must be a positive number."@en ;
            sh:name "Height" ;
            sh:order 2 ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path manifest:height ;
        ],
        [
            sh:description "Specifies the depth (z-axis) of the item in appropriate units."@en ;
            skos:example "0" ;
            sh:datatype xsd:decimal ;
            sh:message "Depth must be a positive whole number."@en ;
            sh:name "Depth" ;
            sh:order 2 ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path manifest:depth ;
        ];
    sh:targetClass manifest:Dimensions .

